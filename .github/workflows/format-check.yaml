# Nixフォーマットチェック Reusable Workflow
#
# nix fmt でコードフォーマットの一貫性を検証する。
# --fail-on-change フラグにより、未フォーマットのコードがあればCIを失敗させる。
#
# 使用方法:
#   uses: shinbunbun/nix-ci-workflows/.github/workflows/format-check.yaml@main

name: Format Check

on:
  workflow_call:
    inputs:
      runner:
        description: 'GitHub Actions runner'
        type: string
        default: 'ubuntu-latest'
      skip-nix-install:
        description: 'Skip Nix installation (for self-hosted NixOS runners)'
        type: boolean
        default: false

jobs:
  format-check:
    runs-on: ${{ startsWith(inputs.runner, '[') && fromJSON(inputs.runner) || inputs.runner }}
    steps:
      - uses: actions/checkout@v4
      - name: Install Nix with flakes enabled
        if: ${{ !inputs.skip-nix-install }}
        uses: cachix/install-nix-action@v31
        with:
          extra_nix_config: |
            experimental-features = nix-command flakes
            access-tokens = github.com=${{ github.token }}
      - name: Check Nix code formatting
        run: nix fmt -- --fail-on-change
